const fs = require('fs');
const path = require('path');

const volumeLinks = {
  1: "https://amzn.to/4rFV58a", 2: "https://amzn.to/4baPaSs", 3: "https://amzn.to/478ByEU",
  4: "https://amzn.to/4kYJvlY", 5: "https://amzn.to/4rCIXot", 6: "https://amzn.to/4tTi2pI",
  7: "https://amzn.to/4kSgKXU", 8: "https://amzn.to/4ckIp1L", 9: "https://amzn.to/4aP4NOe",
  10: "https://amzn.to/4lf9mq5", 11: "https://amzn.to/4cPkdo9", 12: "https://amzn.to/3ZX1yzf",
  13: "https://amzn.to/3ZZWhqH", 14: "https://amzn.to/4c92oQO", 15: "https://amzn.to/4aP8Slt",
  16: "https://amzn.to/3P0Yboy", 17: "https://amzn.to/40AMFml", 18: "https://amzn.to/4s5WC73",
  19: "https://amzn.to/3ZZ1ajP", 20: "https://amzn.to/4rwPnoZ", 21: "https://amzn.to/4rFWdZs",
  22: "https://amzn.to/4aBuW4b", 23: "https://amzn.to/4tVEtKV", 24: "https://amzn.to/4u0DwBi",
  25: "https://amzn.to/3OsBOZd", 26: "https://amzn.to/3OsDcen", 27: "https://amzn.to/4kRZEJQ",
  28: "https://amzn.to/4aW8hyt", 29: "https://amzn.to/4aSZdu8", 30: "https://amzn.to/4r18feO",
  31: "https://amzn.to/40tNnSm", 32: "https://amzn.to/4sbjwKq", 33: "https://amzn.to/4tWOJCN",
  34: "https://amzn.to/4u0E61W", 35: "https://amzn.to/3ZX2nYR", 36: "https://amzn.to/4qVQhu4",
  37: "https://amzn.to/4kVkFDi", 38: "https://amzn.to/3ZTB8hZ", 39: "https://amzn.to/4rBIN0p",
  40: "https://amzn.to/46pi8eN", 41: "https://amzn.to/4sfnnWY", 42: "https://amzn.to/4sa4wwg",
  43: "https://amzn.to/3OyktxX", 44: "https://amzn.to/4cayzzi", 45: "https://amzn.to/4cOfzXB",
  46: "https://amzn.to/4r197A6", 47: "https://amzn.to/4r2qVLd", 48: "https://amzn.to/3OLOudz",
  49: "https://amzn.to/3OzwqmZ", 50: "https://amzn.to/4rweacI", 51: "https://amzn.to/4rweacI",
  52: "https://amzn.to/4aQawmL", 53: "https://amzn.to/4aQPpAK", 54: "https://amzn.to/4cNy0vu",
  55: "https://amzn.to/4ce0wX5", 56: "https://amzn.to/4aSOjVu", 57: "https://amzn.to/4ce0GOb",
  58: "https://amzn.to/4aSOnEI", 59: "https://amzn.to/40uaegD", 60: "https://amzn.to/47d47B8",
  61: "https://amzn.to/4s9k6Iz", 63: "https://amzn.to/3MJisOW", 64: "https://amzn.to/3OA6ojG",
  65: "https://amzn.to/4rFZurI", 66: "https://amzn.to/4tRob65", 68: "https://amzn.to/4aSQ3y0",
  69: "https://amzn.to/4sdmy0J", 70: "https://amzn.to/4rFZLLg", 71: "https://amzn.to/3N5y7YV",
  72: "https://amzn.to/4rMpNMP", 73: "https://amzn.to/4rDWY5e", 74: "https://amzn.to/3Oyn6zP",
  75: "https://amzn.to/4u1wAE6", 76: "https://amzn.to/46MRPzx", 77: "https://amzn.to/4kZpjAr",
  78: "https://amzn.to/40wNRao", 79: "https://amzn.to/4kUVwJd", 80: "https://amzn.to/4tUsjBZ",
  81: "https://amzn.to/4sgWyBL", 82: "https://amzn.to/4aSY8Tl", 83: "https://amzn.to/46rYTkQ",
  84: "https://amzn.to/4tUsptl", 85: "https://amzn.to/3ZWBTH4", 86: "https://amzn.to/3OxAzYI",
  87: "https://amzn.to/3ZTEscX", 88: "https://amzn.to/4aDuylT", 89: "https://amzn.to/4aZUNlw",
  90: "https://amzn.to/4r2tZXJ", 91: "https://amzn.to/46sWJRV", 92: "https://amzn.to/3ODzFK8",
  93: "https://amzn.to/4qY4p63", 94: "https://amzn.to/4qSwyeH", 95: "https://amzn.to/4seP4zd",
  96: "https://amzn.to/46m67H6", 97: "https://amzn.to/4r34Pbn", 98: "https://amzn.to/4aP9UxU",
  99: "https://amzn.to/3MuIVQf", 100: "https://amzn.to/40025R1", 101: "https://amzn.to/4sbfAcE",
  102: "https://amzn.to/3ZWCW9Y", 103: "https://amzn.to/4sgoaXM", 104: "https://amzn.to/4ue63DF",
  105: "https://amzn.to/4tWVVyS", 106: "https://amzn.to/46orDem", 107: "https://amzn.to/4aC9hsL",
  108: "https://amzn.to/4aDvV41", 109: "https://amzn.to/4kVlD2B", 110: "https://amzn.to/4c98gcO",
  112: "https://amzn.to/4sbRFKb"
};

const chapterToVolume = {
  1: 1, 2: 1, 3: 1, 4: 1, 5: 1, 6: 1, 7: 1, 8: 1,
  9: 2, 10: 2, 11: 2, 12: 2, 13: 2, 14: 2, 15: 2, 16: 2, 17: 2,
  18: 3, 19: 3, 20: 3, 21: 3, 22: 3, 23: 3, 24: 3, 25: 3, 26: 3,
  27: 4, 28: 4, 29: 4, 30: 4, 31: 4, 32: 4, 33: 4, 34: 4, 35: 4, 36: 4,
  37: 5, 38: 5, 39: 5, 40: 5, 41: 5, 42: 5, 43: 5, 44: 5, 45: 5, 46: 5,
  47: 6, 48: 6, 49: 6, 50: 6, 51: 6, 52: 6, 53: 6, 54: 6, 55: 6, 56: 6,
  57: 7, 58: 7, 59: 7, 60: 7, 61: 7, 62: 7, 63: 7, 64: 7, 65: 7, 66: 7,
  67: 8, 68: 8, 69: 8, 70: 8, 71: 8, 72: 8, 73: 8, 74: 8, 75: 8, 76: 8,
  77: 9, 78: 9, 79: 9, 80: 9, 81: 9, 82: 9, 83: 9, 84: 9, 85: 9,
  86: 10, 87: 10, 88: 10, 89: 10, 90: 10, 91: 10, 92: 10, 93: 10, 94: 10, 95: 10,
  96: 11, 97: 11, 98: 11, 99: 11, 100: 11, 101: 11, 102: 11, 103: 11, 104: 11, 105: 11,
  106: 12, 107: 12, 108: 12, 109: 12, 110: 12, 111: 12, 112: 12, 113: 12, 114: 12, 115: 12,
  116: 13, 117: 13, 118: 13, 119: 13, 120: 13, 121: 13, 122: 13, 123: 13, 124: 13, 125: 13,
  126: 14, 127: 14, 128: 14, 129: 14, 130: 14, 131: 14, 132: 14, 133: 14, 134: 14, 135: 14,
  136: 15, 137: 15, 138: 15, 139: 15, 140: 15, 141: 15, 142: 15, 143: 15, 144: 15, 145: 15,
  146: 16, 147: 16, 148: 16, 149: 16, 150: 16, 151: 16, 152: 16, 153: 16, 154: 16, 155: 16,
  156: 17, 157: 17, 158: 17, 159: 17, 160: 17, 161: 17, 162: 17, 163: 17, 164: 17, 165: 17,
  166: 18, 167: 18, 168: 18, 169: 18, 170: 18, 171: 18, 172: 18, 173: 18, 174: 18, 175: 18,
  176: 19, 177: 19, 178: 19, 179: 19, 180: 19, 181: 19, 182: 19, 183: 19, 184: 19, 185: 19,
  186: 20, 187: 20, 188: 20, 189: 20, 190: 20, 191: 20, 192: 20, 193: 20, 194: 20, 195: 20,
  196: 21, 197: 21, 198: 21, 199: 21, 200: 21, 201: 21, 202: 21, 203: 21, 204: 21, 205: 21,
  206: 22, 207: 22, 208: 22, 209: 22, 210: 22, 211: 22, 212: 22, 213: 22, 214: 22, 215: 22,
  216: 23, 217: 23, 218: 23, 219: 23, 220: 23, 221: 23, 222: 23, 223: 23, 224: 23, 225: 23,
  226: 24, 227: 24, 228: 24, 229: 24, 230: 24, 231: 24, 232: 24, 233: 24, 234: 24, 235: 24,
  236: 25, 237: 25, 238: 25, 239: 25, 240: 25, 241: 25, 242: 25, 243: 25, 244: 25, 245: 25,
  246: 26, 247: 26, 248: 26, 249: 26, 250: 26, 251: 26, 252: 26, 253: 26, 254: 26, 255: 26,
  256: 27, 257: 27, 258: 27, 259: 27, 260: 27, 261: 27, 262: 27, 263: 27, 264: 27, 265: 27,
  266: 28, 267: 28, 268: 28, 269: 28, 270: 28, 271: 28, 272: 28, 273: 28, 274: 28, 275: 28,
  276: 29, 277: 29, 278: 29, 279: 29, 280: 29, 281: 29, 282: 29, 283: 29, 284: 29, 285: 29,
  286: 30, 287: 30, 288: 30, 289: 30, 290: 30, 291: 30, 292: 30, 293: 30, 294: 30, 295: 30,
  296: 31, 297: 31, 298: 31, 299: 31, 300: 31, 301: 31, 302: 31, 303: 31, 304: 31, 305: 31,
  306: 32, 307: 32, 308: 32, 309: 32, 310: 32, 311: 32, 312: 32, 313: 32, 314: 32, 315: 32,
  316: 33, 317: 33, 318: 33, 319: 33, 320: 33, 321: 33, 322: 33, 323: 33, 324: 33, 325: 33,
  326: 34, 327: 34, 328: 34, 329: 34, 330: 34, 331: 34, 332: 34, 333: 34, 334: 34, 335: 34,
  336: 35, 337: 35, 338: 35, 339: 35, 340: 35, 341: 35, 342: 35, 343: 35, 344: 35, 345: 35,
  346: 36, 347: 36, 348: 36, 349: 36, 350: 36, 351: 36, 352: 36, 353: 36, 354: 36, 355: 36,
  356: 37, 357: 37, 358: 37, 359: 37, 360: 37, 361: 37, 362: 37, 363: 37, 364: 37, 365: 37,
  366: 38, 367: 38, 368: 38, 369: 38, 370: 38, 371: 38, 372: 38, 373: 38, 374: 38, 375: 38,
  376: 39, 377: 39, 378: 39, 379: 39, 380: 39, 381: 39, 382: 39, 383: 39, 384: 39, 385: 39,
  386: 40, 387: 40, 388: 40, 389: 40, 390: 40, 391: 40, 392: 40, 393: 40, 394: 40, 395: 40,
  396: 41, 397: 41, 398: 41, 399: 41, 400: 41, 401: 41, 402: 41, 403: 41, 404: 41, 405: 41,
  406: 42, 407: 42, 408: 42, 409: 42, 410: 42, 411: 42, 412: 42, 413: 42, 414: 42, 415: 42,
  416: 43, 417: 43, 418: 43, 419: 43, 420: 43, 421: 43, 422: 43, 423: 43, 424: 43, 425: 43,
  426: 44, 427: 44, 428: 44, 429: 44, 430: 44, 431: 44, 432: 44, 433: 44, 434: 44, 435: 44,
  436: 45, 437: 45, 438: 45, 439: 45, 440: 45, 441: 45, 442: 45, 443: 45, 444: 45, 445: 45,
  446: 46, 447: 46, 448: 46, 449: 46, 450: 46, 451: 46, 452: 46, 453: 46, 454: 46, 455: 46,
  456: 47, 457: 47, 458: 47, 459: 47, 460: 47, 461: 47, 462: 47, 463: 47, 464: 47, 465: 47,
  466: 48, 467: 48, 468: 48, 469: 48, 470: 48, 471: 48, 472: 48, 473: 48, 474: 48, 475: 48,
  476: 49, 477: 49, 478: 49, 479: 49, 480: 49, 481: 49, 482: 49, 483: 49, 484: 49, 485: 49,
  486: 50, 487: 50, 488: 50, 489: 50, 490: 50, 491: 50, 492: 50, 493: 50, 494: 50, 495: 50,
  496: 51, 497: 51, 498: 51, 499: 51, 500: 51, 501: 51, 502: 51, 503: 51, 504: 51, 505: 51,
  506: 52, 507: 52, 508: 52, 509: 52, 510: 52, 511: 52, 512: 52, 513: 52, 514: 52, 515: 52,
  516: 53, 517: 53, 518: 53, 519: 53, 520: 53, 521: 53, 522: 53, 523: 53, 524: 53, 525: 53,
  526: 54, 527: 54, 528: 54, 529: 54, 530: 54, 531: 54, 532: 54, 533: 54, 534: 54, 535: 54,
  536: 55, 537: 55, 538: 55, 539: 55, 540: 55, 541: 55, 542: 55, 543: 55, 544: 55, 545: 55,
  546: 56, 547: 56, 548: 56, 549: 56, 550: 56, 551: 56, 552: 56, 553: 56, 554: 56, 555: 56,
  556: 57, 557: 57, 558: 57, 559: 57, 560: 57, 561: 57, 562: 57, 563: 57, 564: 57, 565: 57,
  566: 58, 567: 58, 568: 58, 569: 58, 570: 58, 571: 58, 572: 58, 573: 58, 574: 58, 575: 58,
  576: 59, 577: 59, 578: 59, 579: 59, 580: 59, 581: 59, 582: 59, 583: 59, 584: 59, 585: 59,
  586: 60, 587: 60, 588: 60, 589: 60, 590: 60, 591: 60, 592: 60, 593: 60, 594: 60, 595: 60,
  596: 61, 597: 61, 598: 61, 599: 61, 600: 61, 601: 61, 602: 61, 603: 61, 604: 61, 605: 61,
  606: 62, 607: 62, 608: 62, 609: 62, 610: 62, 611: 62, 612: 62, 613: 62, 614: 62, 615: 62,
  616: 63, 617: 63, 618: 63, 619: 63, 620: 63, 621: 63, 622: 63, 623: 63, 624: 63, 625: 63,
  626: 64, 627: 64, 628: 64, 629: 64, 630: 64, 631: 64, 632: 64, 633: 64, 634: 64, 635: 64,
  636: 65, 637: 65, 638: 65, 639: 65, 640: 65, 641: 65, 642: 65, 643: 65, 644: 65, 645: 65,
  646: 66, 647: 66, 648: 66, 649: 66, 650: 66, 651: 66, 652: 66, 653: 66, 654: 66, 655: 66,
  656: 67, 657: 67, 658: 67, 659: 67, 660: 67, 661: 67, 662: 67, 663: 67, 664: 67, 665: 67,
  666: 68, 667: 68, 668: 68, 669: 68, 670: 68, 671: 68, 672: 68, 673: 68, 674: 68, 675: 68,
  676: 69, 677: 69, 678: 69, 679: 69, 680: 69, 681: 69, 682: 69, 683: 69, 684: 69, 685: 69,
  686: 70, 687: 70, 688: 70, 689: 70, 690: 70, 691: 70, 692: 70, 693: 70, 694: 70, 695: 70,
  696: 71, 697: 71, 698: 71, 699: 71, 700: 71, 701: 71, 702: 71, 703: 71, 704: 71, 705: 71,
  706: 72, 707: 72, 708: 72, 709: 72, 710: 72, 711: 72, 712: 72, 713: 72, 714: 72, 715: 72,
  716: 73, 717: 73, 718: 73, 719: 73, 720: 73, 721: 73, 722: 73, 723: 73, 724: 73, 725: 73,
  726: 74, 727: 74, 728: 74, 729: 74, 730: 74, 731: 74, 732: 74, 733: 74, 734: 74, 735: 74,
  736: 75, 737: 75, 738: 75, 739: 75, 740: 75, 741: 75, 742: 75, 743: 75, 744: 75, 745: 75,
  746: 76, 747: 76, 748: 76, 749: 76, 750: 76, 751: 76, 752: 76, 753: 76, 754: 76, 755: 76,
  756: 77, 757: 77, 758: 77, 759: 77, 760: 77, 761: 77, 762: 77, 763: 77, 764: 77, 765: 77,
  766: 78, 767: 78, 768: 78, 769: 78, 770: 78, 771: 78, 772: 78, 773: 78, 774: 78, 775: 78,
  776: 79, 777: 79, 778: 79, 779: 79, 780: 79, 781: 79, 782: 79, 783: 79, 784: 79, 785: 79,
  786: 80, 787: 80, 788: 80, 789: 80, 790: 80, 791: 80, 792: 80, 793: 80, 794: 80, 795: 80,
  796: 81, 797: 81, 798: 81, 799: 81, 800: 81, 801: 81, 802: 81, 803: 81, 804: 81, 805: 81,
  806: 82, 807: 82, 808: 82, 809: 82, 810: 82, 811: 82, 812: 82, 813: 82, 814: 82, 815: 82,
  816: 83, 817: 83, 818: 83, 819: 83, 820: 83, 821: 83, 822: 83, 823: 83, 824: 83, 825: 83,
  826: 84, 827: 84, 828: 84, 829: 84, 830: 84, 831: 84, 832: 84, 833: 84, 834: 84, 835: 84,
  836: 85, 837: 85, 838: 85, 839: 85, 840: 85, 841: 85, 842: 85, 843: 85, 844: 85, 845: 85,
  846: 86, 847: 86, 848: 86, 849: 86, 850: 86, 851: 86, 852: 86, 853: 86, 854: 86, 855: 86,
  856: 87, 857: 87, 858: 87, 859: 87, 860: 87, 861: 87, 862: 87, 863: 87, 864: 87, 865: 87,
  866: 88, 867: 88, 868: 88, 869: 88, 870: 88, 871: 88, 872: 88, 873: 88, 874: 88, 875: 88,
  876: 89, 877: 89, 878: 89, 879: 89, 880: 89, 881: 89, 882: 89, 883: 89, 884: 89, 885: 89,
  886: 90, 887: 90, 888: 90, 889: 90, 890: 90, 891: 90, 892: 90, 893: 90, 894: 90, 895: 90,
  896: 91, 897: 91, 898: 91, 899: 91, 900: 91, 901: 91, 902: 91, 903: 91, 904: 91, 905: 91,
  906: 92, 907: 92, 908: 92, 909: 92, 910: 92, 911: 92, 912: 92, 913: 92, 914: 92, 915: 92,
  916: 93, 917: 93, 918: 93, 919: 93, 920: 93, 921: 93, 922: 93, 923: 93, 924: 93, 925: 93,
  926: 94, 927: 94, 928: 94, 929: 94, 930: 94, 931: 94, 932: 94, 933: 94, 934: 94, 935: 94,
  936: 95, 937: 95, 938: 95, 939: 95, 940: 95, 941: 95, 942: 95, 943: 95, 944: 95, 945: 95,
  946: 96, 947: 96, 948: 96, 949: 96, 950: 96, 951: 96, 952: 96, 953: 96, 954: 96, 955: 96,
  956: 97, 957: 97, 958: 97, 959: 97, 960: 97, 961: 97, 962: 97, 963: 97, 964: 97, 965: 97,
  966: 98, 967: 98, 968: 98, 969: 98, 970: 98, 971: 98, 972: 98, 973: 98, 974: 98, 975: 98,
  976: 99, 977: 99, 978: 99, 979: 99, 980: 99, 981: 99, 982: 99, 983: 99, 984: 99, 985: 99,
  986: 100, 987: 100, 988: 100, 989: 100, 990: 100, 991: 100, 992: 100, 993: 100, 994: 100, 995: 100,
  996: 101, 997: 101, 998: 101, 999: 101, 1000: 101, 1001: 101, 1002: 101, 1003: 101, 1004: 101, 1005: 101,
  1006: 102, 1007: 102, 1008: 102, 1009: 102, 1010: 102, 1011: 102, 1012: 102, 1013: 102, 1014: 102, 1015: 102,
  1016: 103, 1017: 103, 1018: 103, 1019: 103, 1020: 103, 1021: 103, 1022: 103, 1023: 103, 1024: 103, 1025: 103,
  1026: 104, 1027: 104, 1028: 104, 1029: 104, 1030: 104, 1031: 104, 1032: 104, 1033: 104, 1034: 104, 1035: 104,
  1036: 104, 1037: 104, 1038: 104, 1039: 104, 1040: 104, 1041: 104, 1042: 104, 1043: 104, 1044: 104, 1045: 104,
  1046: 104, 1047: 104, 1048: 104, 1049: 104, 1050: 104, 1051: 104, 1052: 104, 1053: 104, 1054: 104, 1055: 104,
  1056: 105, 1057: 105, 1058: 105, 1059: 105, 1060: 105, 1061: 105, 1062: 105, 1063: 105, 1064: 105, 1065: 105,
  1066: 106, 1067: 106, 1068: 106, 1069: 106, 1070: 106, 1071: 106, 1072: 106, 1073: 106, 1074: 106, 1075: 106,
  1076: 107, 1077: 107, 1078: 107, 1079: 107, 1080: 107, 1081: 107, 1082: 107, 1083: 107, 1084: 107, 1085: 107,
  1086: 108, 1087: 108, 1088: 108, 1089: 108, 1090: 108, 1091: 108, 1092: 108, 1093: 108, 1094: 108, 1095: 108,
  1096: 109, 1097: 109, 1098: 109, 1099: 109, 1100: 109, 1101: 109, 1102: 109, 1103: 109, 1104: 109, 1105: 109,
  1106: 110, 1107: 110, 1108: 110, 1109: 110, 1110: 110, 1111: 110, 1112: 110, 1113: 110, 1114: 110, 1115: 110,
  1116: 111, 1117: 111, 1118: 111, 1119: 111, 1120: 111, 1121: 111, 1122: 111, 1123: 111, 1124: 111, 1125: 111,
  1126: 112, 1127: 112, 1128: 112, 1129: 112, 1130: 112, 1131: 112, 1132: 112, 1133: 112, 1134: 112, 1135: 112
};

function extractChapterNumber(label) {
  const match = label.match(/Capítulo\s+(\d+)/i) || label.match(/Chapter\s+(\d+)/i);
  if (match) {
    return parseInt(match[1]);
  }
  
  const rangeMatch = label.match(/Capítulo\s+(\d+)-(\d+)/i);
  if (rangeMatch) {
    return parseInt(rangeMatch[1]);
  }
  
  return null;
}

const eventsDir = path.join(__dirname, '..', 'public', 'data', 'events');
const files = fs.readdirSync(eventsDir);
const eventsWithoutVolume = [];

files.forEach(file => {
  if (!file.endsWith('.json')) return;
  
  const filePath = path.join(eventsDir, file);
  const event = JSON.parse(fs.readFileSync(filePath, 'utf-8'));
  
  if (!event.sources || event.sources.length === 0) {
    eventsWithoutVolume.push({ file, reason: 'No sources field' });
    return;
  }
  
  let updated = false;
  event.sources = event.sources.map(source => {
    if (source.type === 'manga' && !source.url) {
      const chapterNum = extractChapterNumber(source.label);
      if (chapterNum && chapterToVolume[chapterNum]) {
        const volumeNum = chapterToVolume[chapterNum];
        if (volumeLinks[volumeNum]) {
          updated = true;
          return {
            label: `Volume ${volumeNum} - ${source.label}`,
            url: volumeLinks[volumeNum],
            type: 'manga'
          };
        } else {
          eventsWithoutVolume.push({ file, reason: `Volume ${volumeNum} link not found`, chapter: chapterNum });
        }
      } else {
        eventsWithoutVolume.push({ file, reason: `Could not extract chapter number from: ${source.label}` });
      }
    }
    return source;
  });
  
  if (updated) {
    fs.writeFileSync(filePath, JSON.stringify(event, null, 2) + '\n', 'utf-8');
    console.log(`✓ Updated: ${file}`);
  }
});

console.log('\n\n=== EVENTS WITHOUT VOLUME INFORMATION ===\n');
eventsWithoutVolume.forEach(item => {
  console.log(`- ${item.file}: ${item.reason}${item.chapter ? ` (Chapter ${item.chapter})` : ''}`);
});
console.log(`\nTotal: ${eventsWithoutVolume.length} events`);
